<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="theme-color" content="#F4F4F1" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <link rel="apple-touch-icon" href="%BASE_URL%icons/icon-192x192.png" />
    <link rel="manifest" href="%BASE_URL%manifest.webmanifest" />
    <link rel="icon" href="%BASE_URL%favicon.ico" />

    <!-- iOS splash images (generated by tools/generate-icons.js) - make these base-aware for project pages -->
    <link rel="apple-touch-startup-image" href="%BASE_URL%icons/apple-splash-640-1136.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" />
    <link rel="apple-touch-startup-image" href="%BASE_URL%icons/apple-splash-750-1334.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" />
    <link rel="apple-touch-startup-image" href="%BASE_URL%icons/apple-splash-1125-2436.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)" />
    <link rel="apple-touch-startup-image" href="%BASE_URL%icons/apple-splash-1242-2688.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)" />
    <link rel="apple-touch-startup-image" href="%BASE_URL%icons/apple-splash-1536-2048.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)" />

    <title>Flow RSVP — Design System</title>
  <meta name="apple-mobile-web-app-title" content="Flow" />
  </head>
  <body>
    <!-- Safety-Orange splash fallback for platforms that show initial paint -->
    <div id="splash-fallback" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#FF5C00;z-index:9999;">
      <img src="%BASE_URL%icons/flowy-icon.svg" alt="Flowy" style="width:120px;height:120px;border-radius:28px;" />
    </div>

    <div id="root"></div>
    <script>
      // Force-unregister service workers and clear caches for stuck/stale clients.
      (async function(){
        if(!('serviceWorker' in navigator)) return;
        try{
          const regs = await navigator.serviceWorker.getRegistrations();
          if(regs && regs.length){
            // Unregister all to ensure fresh assets on next load
            await Promise.all(regs.map(r => r.unregister().catch(()=>{})));
            // Clear caches
            if('caches' in window){
              try{ const keys = await caches.keys(); await Promise.all(keys.map(k=>caches.delete(k))); }catch(e){}
            }
            console.info('[FLOW] Force-unregistered service workers and cleared caches. Reloading...');
            setTimeout(()=>location.reload(), 150);
          }
        }catch(e){console.warn('[FLOW] SW unregister failed', e)}
      })();
    </script>
    <script>
      // Preserve the splash until the app explicitly removes it.
      // Earlier behavior removed the splash on `load` which could leave a white screen
      // if the JS bundle failed to initialize — keep the splash so the app can
      // show an error UI instead. App will remove the splash on successful mount.
      window.__FLOW_PRESERVE_SPLASH = true;
      // progressive accessibility hint if the app hasn't mounted after 3s
      setTimeout(()=>{try{const s=document.getElementById('splash-fallback');if(s){s.setAttribute('aria-busy','true');const note=document.createElement('div');note.style.cssText='color:rgba(26,26,26,0.6);font-size:13px;margin-top:12px';note.textContent='Loading — if this persists, open DevTools → Console for details.';s.appendChild(note)}}catch(e){}},3000);
    </script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
